WEBVTT

00:00.000 --> 00:07.000
How many of you are still awake?

00:07.000 --> 00:09.000
Let's have a show of hands.

00:09.000 --> 00:12.000
Okay, 90%.

00:12.000 --> 00:13.000
Very good.

00:13.000 --> 00:14.000
Very good.

00:14.000 --> 00:19.000
How many of you work in mobility in your day job?

00:19.000 --> 00:24.000
All right, that's about 25%.

00:24.000 --> 00:31.000
How many of you would like to work in mobility as your day job?

00:31.000 --> 00:36.000
These are the superheroes of the next generation.

00:36.000 --> 00:41.000
How many of you have worked with passenger counting before?

00:41.000 --> 00:43.000
All right, five.

00:43.000 --> 00:44.000
Excellent.

00:44.000 --> 00:46.000
All right.

00:46.000 --> 00:53.000
So this story, this is like a few of the things that I want to highlight in the development

00:53.000 --> 00:59.000
of the Finnish national automatic passenger counting system.

00:59.000 --> 01:07.000
And there are like bits for everyone, and I'm going to be fairly speedy with these things.

01:07.000 --> 01:10.000
And if you have questions, please ask them at the end.

01:10.000 --> 01:16.000
And let's get started.

01:16.000 --> 01:24.000
So I've been working in public transit for a bit over 10 years now, and software development

01:24.000 --> 01:27.000
for a bit over 15.

01:27.000 --> 01:34.000
And I started my own consulting company five years ago when I wanted to help more organizations

01:34.000 --> 01:35.000
as well.

01:35.000 --> 01:39.000
But I just wanted to give you a bit of background that I come from the public transport side

01:39.000 --> 01:45.000
and not so much from the railway side.

01:46.000 --> 01:48.000
So just the basics.

01:48.000 --> 01:53.000
What is automatic passenger counting?

01:53.000 --> 01:58.000
It just answers the simple question, how many people are there in the vehicle?

01:58.000 --> 02:04.000
There are two different kinds of messages that these vendors send.

02:04.000 --> 02:12.000
For example, they send how many people went in or how many people went out of this particular door.

02:13.000 --> 02:18.000
And then there's the option of telling how many people there are in the vehicle right now.

02:18.000 --> 02:26.000
And some vendors send both of these data, and then you have to decide, speak louder?

02:26.000 --> 02:27.000
Yeah.

02:27.000 --> 02:29.000
All right, thanks.

02:29.000 --> 02:35.000
So some vendors send both of these data, and then you have to decide which one you trust,

02:35.000 --> 02:38.000
the DIF or the total.

02:42.000 --> 02:45.000
So why do we collect this?

02:45.000 --> 02:48.000
For the passenger, the benefit is quite obvious.

02:48.000 --> 02:55.000
You want to travel with the less crowded vehicles, mostly.

02:55.000 --> 03:00.000
You get this information from the passenger information systems such as signage.

03:00.000 --> 03:09.000
But also, more and more, I expect that there will be automatic decisions made for you

03:09.000 --> 03:10.000
without you knowing about it.

03:10.000 --> 03:19.000
So trip planners already will suggest trips that are less crowded.

03:19.000 --> 03:23.000
And in the future, I think general technology should already be there,

03:23.000 --> 03:28.000
but that general technology hasn't reached public transit yet.

03:28.000 --> 03:37.000
So we can't yet recognize prams and bikes and such when they come in.

03:37.000 --> 03:48.000
But when we can, then we can tell you if your pram fits in the bus that you're aiming for.

03:48.000 --> 03:54.000
Now for the authorities, the public transport planners, for example,

03:54.000 --> 04:03.000
one of the most important things is to be able to understand where the masses are moving.

04:03.000 --> 04:08.000
So you want to allocate the vehicle capacity where it's needed.

04:08.000 --> 04:17.000
So for example, if there's a route and the last three stops of one direction is often very empty,

04:17.000 --> 04:23.000
then it might make sense to cut the route short and just increase frequency.

04:23.000 --> 04:32.000
Also, some of the trip planners have these status information on how many grams of CO2

04:32.000 --> 04:35.000
have you released when you're traveling.

04:35.000 --> 04:41.000
So that depends on how many other passengers there are in the bus.

04:41.000 --> 04:49.000
Also, pandemic precautions are important driver for the funding of these projects

04:49.000 --> 04:54.000
to finally get these things funded and running.

04:54.000 --> 05:01.000
And also when the passengers choose to even out the load,

05:01.000 --> 05:05.000
when they choose to go to vehicles that are less crowded,

05:05.000 --> 05:15.000
it means that transit becomes smoother because there's less congestion in particular spots.

05:16.000 --> 05:25.000
Now the situation in Finland before COVID and before mobile tickets were very popular.

05:29.000 --> 05:31.000
Aha, I'm hearing myself.

05:31.000 --> 05:35.000
The situation was such that...

05:38.000 --> 05:40.000
Somehow caught me off.

05:46.000 --> 05:50.000
Right.

05:50.000 --> 05:56.000
So there was not much incentive for developing these systems

05:56.000 --> 05:59.000
because we got most of the information from the ticketing systems.

05:59.000 --> 06:03.000
At least we got the information on when people got on.

06:03.000 --> 06:09.000
But in 2020, six municipalities and the government put money together

06:09.000 --> 06:16.000
and pulled it into Valti, Valti's service development company for public transit purposes

06:16.000 --> 06:21.000
owned by the major municipalities of Finland.

06:21.000 --> 06:28.000
And they pulled money together and in 2021, they chose Futurize as the contractor.

06:28.000 --> 06:31.000
Futurize is an excellent service company in Finland

06:31.000 --> 06:38.000
and I was privileged to take part in that team as a technical architect and a lead developer.

06:39.000 --> 06:47.000
And in the next two years, more companies and organizations joined in this project and many phases.

06:47.000 --> 06:51.000
I'm just giving you a bit of the background on it.

06:54.000 --> 07:03.000
I think in hindsight, our main task was to reduce vendor lock-in and to reduce the costs of APC

07:03.000 --> 07:07.000
because currently the high quality sensors take cost...

07:07.000 --> 07:11.000
Typical stereo camera costs 1,000 euros per door

07:11.000 --> 07:17.000
and 203 doors per bus means that it's quite expensive.

07:17.000 --> 07:23.000
And also, I mean, sensibly, many of the vendors want to offer end-to-end service

07:23.000 --> 07:27.000
of providing data and analysis.

07:27.000 --> 07:30.000
But then it's hard to maybe get rid of that vendor

07:30.000 --> 07:35.000
if you want to move on to the next system.

07:35.000 --> 07:43.000
So we interviewed stakeholders, held workshops, sketched out some architecture ideas

07:43.000 --> 07:49.000
and we came up with like a three-prong approach.

07:49.000 --> 07:57.000
And the first one is that we create an API spec between the onboard accounting devices and the backend.

07:58.000 --> 08:08.000
And we try to make it easy to understand for companies that don't work with public transport in general.

08:10.000 --> 08:17.000
And as a starting point, we took from HSL to Helsinki Regional Transport Authority,

08:17.000 --> 08:26.000
the capital area, PTAs, Public Transport Authorities often have the most resources, so they were a bit ahead.

08:26.000 --> 08:34.000
They had this data format that was modified from an earlier data format that they have.

08:34.000 --> 08:42.000
And we wanted to be compatible with HSL, so we don't fragment the finished market.

08:42.000 --> 08:48.000
But also, it has a lot of craft for our needs.

08:48.000 --> 08:51.000
So I've split the chasing message into two columns here.

08:51.000 --> 08:59.000
The first one is more about the APC ideas and the right one is about the general public transport method data,

08:59.000 --> 09:05.000
such as routes and operating dates and directions and such.

09:05.000 --> 09:18.000
And all of the data on the right side is available in the backend anyway from some other source.

09:18.000 --> 09:29.000
So by reducing some of the fields and also trying to get rid of some ambiguities,

09:29.000 --> 09:35.000
we just added schema version and accounting system ID to do matching in the backend

09:35.000 --> 09:43.000
and message ID to make a message checking unique when there are duplicates.

09:44.000 --> 09:49.000
And then we dropped everything that wasn't about the APC.

09:49.000 --> 09:55.000
So these chasing messages are sent over MQTT, which is very commonly used in public transport,

09:55.000 --> 10:03.000
both on board and between backend and vehicles.

10:03.000 --> 10:13.000
And I think this format allows for any company that understands how to count people or objects to participate in this market.

10:13.000 --> 10:18.000
So it lowers the barrier to entry.

10:18.000 --> 10:28.000
And we're hoping that there will be more companies that offer accounting devices.

10:28.000 --> 10:36.000
Okay, the second approach, second attack was to prototype new counting technologies.

10:36.000 --> 10:50.000
And we asked two companies to develop new things and one company to provide a reference device of something that already exists in the market.

10:51.000 --> 11:08.000
And DILCOMP created object detection from security cameras and AmpliCa used a millimeter wavelength radar for the presumably object detection.

11:08.000 --> 11:13.000
And there are a couple of pictures on the upper right, maybe a bit small.

11:13.000 --> 11:26.000
This is a picture of the prototype millimeter wavelength device 3D printed stuff hidden behind the ceiling panel.

11:28.000 --> 11:37.000
Now, unfortunately, unfortunately we learned that 20,000 euros per new technology was not enough.

11:37.000 --> 11:48.000
For us to create breakthrough technology, we managed to create the right format of data, but values were not yet usable.

11:48.000 --> 11:53.000
But maybe some of you can figure this out.

11:53.000 --> 11:55.000
I hope you can.

11:57.000 --> 12:04.000
Okay, the third approach that we created an open source backend for this whole system.

12:04.000 --> 12:10.000
So there's also no great vendor lock into our team either.

12:10.000 --> 12:18.000
And here's like the simplified architecture of it.

12:18.000 --> 12:26.000
And let's forget the left side for now, but in the middle, data comes from the on-port counting systems.

12:26.000 --> 12:28.000
They go to the MQTT broker.

12:28.000 --> 12:32.000
And then we push it into Apache Pulsar.

12:33.000 --> 12:45.000
Apache Pulsar is a distributed append-only log system competitor of Apache Kafka and has been in use at HSL for six years now.

12:45.000 --> 12:55.000
And we also wanted to have synergy there so that Valti and HSL would have similar technology backends.

12:56.000 --> 13:08.000
The messages from the MQTT broker are deduplicated and they're brought into the journey matchup.

13:08.000 --> 13:18.000
Journey matchup also takes its input from GTFS real-time, the vehicle positions which tell where the vehicles go and when they leave the stops.

13:18.000 --> 13:33.000
So it's a very simple logic in principle in journey matchup that you just accumulate values in and out until you leave the stop and then you trigger

13:33.000 --> 13:38.000
APC message with all of the public transport method data that you need in the analytics.

13:38.000 --> 13:44.000
So routes and stops and directions and so on.

13:44.000 --> 13:52.000
So journey matchup pushes it through MQTT back into the provider of the GTFS real-time API.

13:52.000 --> 13:55.000
So that services the authorities.

13:55.000 --> 14:03.000
That's the raw data or raw, but I mean the accurate data as such.

14:03.000 --> 14:07.000
But it doesn't serve the public because this is private data.

14:07.000 --> 14:11.000
This is mobility data of people moving about.

14:11.000 --> 14:20.000
Now you might think, okay, how many people moved in the door doesn't really match with any individual.

14:20.000 --> 14:23.000
But that is not so.

14:23.000 --> 14:37.000
And on the left side we describe how we need information from the vehicle registry as well to pick up data about the vehicle models that we have, the seat configuration and standing places

14:38.000 --> 14:43.000
and how we create an organization profile out of it.

14:43.000 --> 14:46.000
But for this part we need help from experts.

14:46.000 --> 14:55.000
So we asked university researchers from Finnish Center for Artificial Intelligence and Helsinki University.

14:55.000 --> 15:01.000
There's a professor on the home class group that is focusing on differential privacy.

15:01.000 --> 15:08.000
And especially Jonas Jalko and also Raja, sorry.

15:08.000 --> 15:12.000
And oh dear.

15:12.000 --> 15:17.000
Okay, I'll get back to that.

15:17.000 --> 15:18.000
Worked on this.

15:18.000 --> 15:27.000
Jonas was especially working hard on this with me and they created a method for the anonymization.

15:28.000 --> 15:40.000
Now the reasoning why we need this is that if you consider someone who lives maybe not in the city center a bit further away and they travel in a bit peculiar manner.

15:40.000 --> 15:45.000
Let's say that they have shift work, they travel at noon.

15:45.000 --> 15:52.000
The stop that they use, no one else ever gets on that particular route in that particular direction at that particular time except them.

15:52.000 --> 15:56.000
No one else gets off of the bus at that time.

15:56.000 --> 16:08.000
So if you learn that pattern, if that accurate information was public you could stalk them and figure out, okay, now their house is empty and so on.

16:08.000 --> 16:20.000
So to combat that, often I've understood that how people approach it is just been the values.

16:20.000 --> 16:25.000
So for example, if it's five to 20 people in the bus then it's many seats available.

16:25.000 --> 16:36.000
In GTFS real time, standard occupancy status, the occupancy status field has these ordered categories from empty to full.

16:36.000 --> 16:49.000
And the thing is that that's not really anonymization because when you switch from one category to the other you're still leaking information.

16:50.000 --> 17:04.000
So the method that they created based on differential privacy, we believe it is the first differential privacy method for automatic passenger counting in public transport.

17:04.000 --> 17:15.000
And I'm really glad that these researchers made this effort for all of us and it's all open source.

17:15.000 --> 17:18.000
I think it deserves a round of applause.

17:25.000 --> 17:27.000
It's also very simple.

17:30.000 --> 17:37.000
So the above case would be the one where you have no anonymization except the pinning.

17:37.000 --> 17:45.000
So once you switch from four people to five people you go from empty to many seats available.

17:45.000 --> 18:03.000
Now how their method works is that they take that vehicle model, the seats in the standing places, and they turn them into these, they take as input this upper CSV file, CSV, I'll just give you a light.

18:08.000 --> 18:15.000
And they fast these boundaries so that they match the differential privacy condition.

18:15.000 --> 18:18.000
So I'm not an expert on differential privacy.

18:20.000 --> 18:30.000
I'll hedge anyway how it works roughly so that we're actually using epsilon delta differential privacy.

18:30.000 --> 18:45.000
But in the epsilon differential privacy you have the small value epsilon that you can decide and that affects how private versus how usable and accurate your output data is.

18:46.000 --> 19:03.000
And the epsilon affects what's the probability that you can figure out an individual from that data set or whether that result was formed by a data set with a particular individual in it or not.

19:04.000 --> 19:17.000
That probability difference is very small and affected by epsilon and the delta parameter relaxes that condition a bit.

19:17.000 --> 19:21.000
So the black areas here have probability of zero, exactly zero.

19:21.000 --> 19:24.000
So that's the delta in action.

19:24.000 --> 19:31.000
Otherwise you would have these violet purple bars quite far along.

19:31.000 --> 19:37.000
So for example, how you interpret this is also CSV files is visualized.

19:37.000 --> 19:50.000
For example, if you have seven people, you have a small chance of publishing empty and a large chance of publishing many seats available and no chance of publishing any of the other categories.

19:50.000 --> 20:03.000
So we want to have such a system that if the accurate value would be many seats available, we don't accidentally publish full.

20:07.000 --> 20:11.000
The counting of these profiles is quite intensive, takes many hours.

20:11.000 --> 20:20.000
There may be various optimization possibilities in the algorithm, but it needs to be only done once per vehicle model.

20:20.000 --> 20:34.000
And then you have this small CSV file, a table of probabilities that you just sample from every time you need to publish the result at a stop.

20:34.000 --> 20:37.000
So it's very, very fast in use.

20:38.000 --> 20:46.000
And you can just plug it in if you already have another system like the one above.

20:48.000 --> 20:53.000
All right, so this has been a trip of these highlights.

20:53.000 --> 21:00.000
Check out our API spec, especially if you're interested in creating these kind of counting devices.

21:00.000 --> 21:03.000
Please try your hand in it.

21:04.000 --> 21:16.000
They are, the bosses are dirty and they are dusty and they're shaky, but otherwise you can use whatever methods you have available.

21:16.000 --> 21:31.000
Also, if you haven't yet got your own APC system, check out our backend code or maybe our architecture and this idea of not, of having only minimal data from these APC vendors.

21:32.000 --> 21:34.000
It's attractive for you.

21:34.000 --> 21:42.000
And if you already have an APC system, please do use the anonymization method created by the researchers.

21:46.000 --> 21:50.000
If you have further questions after this, you can contact me by that email.

21:50.000 --> 21:51.000
There are a few of the links.

21:51.000 --> 21:55.000
They're also in the talk page.

21:55.000 --> 22:06.000
And I'm not yet sure what else will be behind transit privacy.org, but right now it's just a link to the tool that the researchers created.

22:08.000 --> 22:10.000
That's enough of the monologue.

22:10.000 --> 22:12.000
Let's start the dialogue.

22:25.000 --> 22:35.000
So for public transport, I guess it's very important to easily detect when a road is being inefficient by maybe just moving air.

22:35.000 --> 22:54.000
For example, if in some end of the road, the bus or a tram or whatever is mostly empty, how does this anonymization algorithm make it harder to detect when some public transportation is being under you?

22:54.000 --> 23:08.000
So the question was whether or how this anonymization will affect the public transport planning use case of figuring out whether reallocation is to be done with the vehicle capacity.

23:08.000 --> 23:15.000
In our architecture, the public transport planners get the accurate data into their analytics.

23:15.000 --> 23:20.000
So the anonymization happens after and it's only for the open data part.

23:21.000 --> 23:27.000
Can you speak about your experience with the microwave based sensors?

23:27.000 --> 23:30.000
Oh, the millimeter wavelength radar.

23:30.000 --> 23:32.000
I have no clue.

23:32.000 --> 23:47.000
So we gave these companies a lot of leeway and they produced their pilots and we don't have insight into how exactly that works.

23:51.000 --> 23:55.000
Any insights about the results of their pilot or not?

23:55.000 --> 24:02.000
The insights were that thus far the results were not good enough to be shown.

24:08.000 --> 24:14.000
You haven't actually mentioned the great deal about how counts are actually achieved.

24:14.000 --> 24:15.000
Sorry, I can't hear you.

24:15.000 --> 24:19.000
You haven't explained much about how counts are achieved.

24:19.000 --> 24:23.000
The time has been involved enormously over decades.

24:23.000 --> 24:28.000
In the past you simply used to weigh the carriage.

24:28.000 --> 24:34.000
Now obviously it could be distorted by adults, children, people with a lucky age, Americans, whatever.

24:34.000 --> 24:40.000
Then you don't even know where they are on the train to the carriage.

24:40.000 --> 24:43.000
So you don't know that they're individual though.

24:43.000 --> 24:49.000
Then they looked at things like as you enter an exit using light sensors.

24:49.000 --> 24:56.000
Then they looked at things like are you connected to the internet and counting the number of people who did that.

24:56.000 --> 25:06.000
I suggest that they actually work on facial recognition, not against a database but simply against the number of unique faces on a carriage at a time.

25:06.000 --> 25:10.000
Then you can start as they move around and work out what the behavior is.

25:10.000 --> 25:12.000
What's your thought on that?

25:12.000 --> 25:14.000
Alright, thanks.

25:14.000 --> 25:25.000
There was a brief history of the different kinds of technologies used for detecting passengers and objects.

25:25.000 --> 25:30.000
Then a question of whether facial recognition would work.

25:30.000 --> 25:35.000
I'm not sure if it sounds like it would effectively work.

25:35.000 --> 25:37.000
It could.

25:37.000 --> 25:46.000
It's very tricky how to communicate it to the public in a way that is understood correctly.

25:46.000 --> 25:56.000
Like for example that we don't send anything else that plus one and minus one from these vehicles onwards.

25:56.000 --> 25:58.000
Yes, it's back.

25:58.000 --> 26:03.000
About that, facial recognition, you don't have to go really directly to that.

26:03.000 --> 26:14.000
There is so many more stuff that you can do and with your counting mechanisms, even all the source models can really do much better without having to get any facial information.

26:14.000 --> 26:16.000
If possible, just actually close that out.

26:16.000 --> 26:18.000
You don't really have to get through that.

26:18.000 --> 26:27.000
The layers, like I'm working on model share counting and we're doing that for cycling and we're doing that also for passenger counting and stuff.

26:27.000 --> 26:34.000
You don't need to actually get to mine all these information characteristics of the people who do the tracking algorithm yourself.

26:34.000 --> 26:37.000
It's not really necessary to get there.

26:37.000 --> 26:41.000
That will also reduce the communication.

26:41.000 --> 26:43.000
Thank you.

26:43.000 --> 26:56.000
A comment was about how the object detection and object tracking algorithms on open source are already quite fine without facial recognition.

26:56.000 --> 26:57.000
Yeah.

26:57.000 --> 27:00.000
It's like calculation of CO2 in the carriage.

27:00.000 --> 27:02.000
Sorry, I can't hear you.

27:02.000 --> 27:11.000
Calculation of CO2 in the carriage because when people are breathing, they can reflect air transfer and calculate how people are in this situation.

27:11.000 --> 27:17.000
Other studies have been done for COVID, for example, and you can reuse this COVID study.

27:17.000 --> 27:23.000
My next question is regarding the users of security cameras for counting people.

27:23.000 --> 27:27.000
Do you have any experiences in terms of producers of the systems?

27:27.000 --> 27:35.000
In the moment, you use the camera for a different purpose, the warranty is gone because we have this problem.

27:35.000 --> 27:42.000
This kind of thing is like, let me say, okay, we will never use it for other purposes than just checking security.

27:42.000 --> 27:48.000
This is like a big ego constraint that you have when you're procurement.

27:48.000 --> 27:49.000
Yeah.

27:49.000 --> 27:56.000
A good comment on security camera warranties.

27:56.000 --> 28:13.000
I don't, I remember hearing discussions about that, but I don't have any proper answers about what do the security service providers think about using their camera fees for something else.

28:13.000 --> 28:14.000
Okay.

28:14.000 --> 28:15.000
Thank you.

28:15.000 --> 28:16.000
Thank you.

